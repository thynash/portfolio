{"ast":null,"code":"import{MotionGlobalConfig}from'motion-utils';import{stepsOrder}from'./order.mjs';import{createRenderStep}from'./render-step.mjs';const maxElapsed=40;function createRenderBatcher(scheduleNextBatch,allowKeepAlive){let runNextFrame=false;let useDefaultElapsed=true;const state={delta:0.0,timestamp:0.0,isProcessing:false};const flagRunNextFrame=()=>runNextFrame=true;const steps=stepsOrder.reduce((acc,key)=>{acc[key]=createRenderStep(flagRunNextFrame,allowKeepAlive?key:undefined);return acc;},{});const{setup,read,resolveKeyframes,preUpdate,update,preRender,render,postRender}=steps;const processBatch=()=>{const timestamp=MotionGlobalConfig.useManualTiming?state.timestamp:performance.now();runNextFrame=false;if(!MotionGlobalConfig.useManualTiming){state.delta=useDefaultElapsed?1000/60:Math.max(Math.min(timestamp-state.timestamp,maxElapsed),1);}state.timestamp=timestamp;state.isProcessing=true;// Unrolled render loop for better per-frame performance\nsetup.process(state);read.process(state);resolveKeyframes.process(state);preUpdate.process(state);update.process(state);preRender.process(state);render.process(state);postRender.process(state);state.isProcessing=false;if(runNextFrame&&allowKeepAlive){useDefaultElapsed=false;scheduleNextBatch(processBatch);}};const wake=()=>{runNextFrame=true;useDefaultElapsed=true;if(!state.isProcessing){scheduleNextBatch(processBatch);}};const schedule=stepsOrder.reduce((acc,key)=>{const step=steps[key];acc[key]=function(process){let keepAlive=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;let immediate=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!runNextFrame)wake();return step.schedule(process,keepAlive,immediate);};return acc;},{});const cancel=process=>{for(let i=0;i<stepsOrder.length;i++){steps[stepsOrder[i]].cancel(process);}};return{schedule,cancel,state,steps};}export{createRenderBatcher};","map":{"version":3,"names":["MotionGlobalConfig","stepsOrder","createRenderStep","maxElapsed","createRenderBatcher","scheduleNextBatch","allowKeepAlive","runNextFrame","useDefaultElapsed","state","delta","timestamp","isProcessing","flagRunNextFrame","steps","reduce","acc","key","undefined","setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender","processBatch","useManualTiming","performance","now","Math","max","min","process","wake","schedule","step","keepAlive","arguments","length","immediate","cancel","i"],"sources":["/home/antisyn/portfolio/src/components/node_modules/motion-dom/dist/es/frameloop/batcher.mjs"],"sourcesContent":["import { MotionGlobalConfig } from 'motion-utils';\nimport { stepsOrder } from './order.mjs';\nimport { createRenderStep } from './render-step.mjs';\n\nconst maxElapsed = 40;\nfunction createRenderBatcher(scheduleNextBatch, allowKeepAlive) {\n    let runNextFrame = false;\n    let useDefaultElapsed = true;\n    const state = {\n        delta: 0.0,\n        timestamp: 0.0,\n        isProcessing: false,\n    };\n    const flagRunNextFrame = () => (runNextFrame = true);\n    const steps = stepsOrder.reduce((acc, key) => {\n        acc[key] = createRenderStep(flagRunNextFrame, allowKeepAlive ? key : undefined);\n        return acc;\n    }, {});\n    const { setup, read, resolveKeyframes, preUpdate, update, preRender, render, postRender, } = steps;\n    const processBatch = () => {\n        const timestamp = MotionGlobalConfig.useManualTiming\n            ? state.timestamp\n            : performance.now();\n        runNextFrame = false;\n        if (!MotionGlobalConfig.useManualTiming) {\n            state.delta = useDefaultElapsed\n                ? 1000 / 60\n                : Math.max(Math.min(timestamp - state.timestamp, maxElapsed), 1);\n        }\n        state.timestamp = timestamp;\n        state.isProcessing = true;\n        // Unrolled render loop for better per-frame performance\n        setup.process(state);\n        read.process(state);\n        resolveKeyframes.process(state);\n        preUpdate.process(state);\n        update.process(state);\n        preRender.process(state);\n        render.process(state);\n        postRender.process(state);\n        state.isProcessing = false;\n        if (runNextFrame && allowKeepAlive) {\n            useDefaultElapsed = false;\n            scheduleNextBatch(processBatch);\n        }\n    };\n    const wake = () => {\n        runNextFrame = true;\n        useDefaultElapsed = true;\n        if (!state.isProcessing) {\n            scheduleNextBatch(processBatch);\n        }\n    };\n    const schedule = stepsOrder.reduce((acc, key) => {\n        const step = steps[key];\n        acc[key] = (process, keepAlive = false, immediate = false) => {\n            if (!runNextFrame)\n                wake();\n            return step.schedule(process, keepAlive, immediate);\n        };\n        return acc;\n    }, {});\n    const cancel = (process) => {\n        for (let i = 0; i < stepsOrder.length; i++) {\n            steps[stepsOrder[i]].cancel(process);\n        }\n    };\n    return { schedule, cancel, state, steps };\n}\n\nexport { createRenderBatcher };\n"],"mappings":"AAAA,OAASA,kBAAkB,KAAQ,cAAc,CACjD,OAASC,UAAU,KAAQ,aAAa,CACxC,OAASC,gBAAgB,KAAQ,mBAAmB,CAEpD,KAAM,CAAAC,UAAU,CAAG,EAAE,CACrB,QAAS,CAAAC,mBAAmBA,CAACC,iBAAiB,CAAEC,cAAc,CAAE,CAC5D,GAAI,CAAAC,YAAY,CAAG,KAAK,CACxB,GAAI,CAAAC,iBAAiB,CAAG,IAAI,CAC5B,KAAM,CAAAC,KAAK,CAAG,CACVC,KAAK,CAAE,GAAG,CACVC,SAAS,CAAE,GAAG,CACdC,YAAY,CAAE,KAClB,CAAC,CACD,KAAM,CAAAC,gBAAgB,CAAGA,CAAA,GAAON,YAAY,CAAG,IAAK,CACpD,KAAM,CAAAO,KAAK,CAAGb,UAAU,CAACc,MAAM,CAAC,CAACC,GAAG,CAAEC,GAAG,GAAK,CAC1CD,GAAG,CAACC,GAAG,CAAC,CAAGf,gBAAgB,CAACW,gBAAgB,CAAEP,cAAc,CAAGW,GAAG,CAAGC,SAAS,CAAC,CAC/E,MAAO,CAAAF,GAAG,CACd,CAAC,CAAE,CAAC,CAAC,CAAC,CACN,KAAM,CAAEG,KAAK,CAAEC,IAAI,CAAEC,gBAAgB,CAAEC,SAAS,CAAEC,MAAM,CAAEC,SAAS,CAAEC,MAAM,CAAEC,UAAY,CAAC,CAAGZ,KAAK,CAClG,KAAM,CAAAa,YAAY,CAAGA,CAAA,GAAM,CACvB,KAAM,CAAAhB,SAAS,CAAGX,kBAAkB,CAAC4B,eAAe,CAC9CnB,KAAK,CAACE,SAAS,CACfkB,WAAW,CAACC,GAAG,CAAC,CAAC,CACvBvB,YAAY,CAAG,KAAK,CACpB,GAAI,CAACP,kBAAkB,CAAC4B,eAAe,CAAE,CACrCnB,KAAK,CAACC,KAAK,CAAGF,iBAAiB,CACzB,IAAI,CAAG,EAAE,CACTuB,IAAI,CAACC,GAAG,CAACD,IAAI,CAACE,GAAG,CAACtB,SAAS,CAAGF,KAAK,CAACE,SAAS,CAAER,UAAU,CAAC,CAAE,CAAC,CAAC,CACxE,CACAM,KAAK,CAACE,SAAS,CAAGA,SAAS,CAC3BF,KAAK,CAACG,YAAY,CAAG,IAAI,CACzB;AACAO,KAAK,CAACe,OAAO,CAACzB,KAAK,CAAC,CACpBW,IAAI,CAACc,OAAO,CAACzB,KAAK,CAAC,CACnBY,gBAAgB,CAACa,OAAO,CAACzB,KAAK,CAAC,CAC/Ba,SAAS,CAACY,OAAO,CAACzB,KAAK,CAAC,CACxBc,MAAM,CAACW,OAAO,CAACzB,KAAK,CAAC,CACrBe,SAAS,CAACU,OAAO,CAACzB,KAAK,CAAC,CACxBgB,MAAM,CAACS,OAAO,CAACzB,KAAK,CAAC,CACrBiB,UAAU,CAACQ,OAAO,CAACzB,KAAK,CAAC,CACzBA,KAAK,CAACG,YAAY,CAAG,KAAK,CAC1B,GAAIL,YAAY,EAAID,cAAc,CAAE,CAChCE,iBAAiB,CAAG,KAAK,CACzBH,iBAAiB,CAACsB,YAAY,CAAC,CACnC,CACJ,CAAC,CACD,KAAM,CAAAQ,IAAI,CAAGA,CAAA,GAAM,CACf5B,YAAY,CAAG,IAAI,CACnBC,iBAAiB,CAAG,IAAI,CACxB,GAAI,CAACC,KAAK,CAACG,YAAY,CAAE,CACrBP,iBAAiB,CAACsB,YAAY,CAAC,CACnC,CACJ,CAAC,CACD,KAAM,CAAAS,QAAQ,CAAGnC,UAAU,CAACc,MAAM,CAAC,CAACC,GAAG,CAAEC,GAAG,GAAK,CAC7C,KAAM,CAAAoB,IAAI,CAAGvB,KAAK,CAACG,GAAG,CAAC,CACvBD,GAAG,CAACC,GAAG,CAAC,CAAG,SAACiB,OAAO,CAA2C,IAAzC,CAAAI,SAAS,CAAAC,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAArB,SAAA,CAAAqB,SAAA,IAAG,KAAK,IAAE,CAAAE,SAAS,CAAAF,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAArB,SAAA,CAAAqB,SAAA,IAAG,KAAK,CACrD,GAAI,CAAChC,YAAY,CACb4B,IAAI,CAAC,CAAC,CACV,MAAO,CAAAE,IAAI,CAACD,QAAQ,CAACF,OAAO,CAAEI,SAAS,CAAEG,SAAS,CAAC,CACvD,CAAC,CACD,MAAO,CAAAzB,GAAG,CACd,CAAC,CAAE,CAAC,CAAC,CAAC,CACN,KAAM,CAAA0B,MAAM,CAAIR,OAAO,EAAK,CACxB,IAAK,GAAI,CAAAS,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAG1C,UAAU,CAACuC,MAAM,CAAEG,CAAC,EAAE,CAAE,CACxC7B,KAAK,CAACb,UAAU,CAAC0C,CAAC,CAAC,CAAC,CAACD,MAAM,CAACR,OAAO,CAAC,CACxC,CACJ,CAAC,CACD,MAAO,CAAEE,QAAQ,CAAEM,MAAM,CAAEjC,KAAK,CAAEK,KAAM,CAAC,CAC7C,CAEA,OAASV,mBAAmB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}